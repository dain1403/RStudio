setwd("c:/Rdata") 
data = read.csv("programming.csv")
head(data)

## glm ??“£??„»?ë¹? æ¿¡ì’–??€??’ª??–›??‰¶æ´¹Â€ï§â‘¦?‚??“£ fitting??–†?ê¶???–. 
## family='binomial' ??”¤??˜„?‘œ? ??„»?ë¹?, glm??‘æ¿?? æ¿¡ì’–??€??’ª??–› ??‰¶æ´¹Â€ï§â‘¦?‚??“£ ?ë²? ??‹” ??—³??–
model = glm(Success ~ Experience,data = data, family = binomial(logit))
summary(model)
cbind(data$Experience, model$fitted.values)
plot(Success~Experience, data = data)
points(model$fitted.values ~ data$Experience, col = 2)

table(data$Success, model$fitted.values > 0.5)
c('èª˜ì‡¨ì»??ë£?' = 8/11, '??“…??” ?ë£?' = 11/24)

data = read.csv("coupon.csv")
head(data)
model2 = glm(cbind(N_redeemed, N-N_redeemed)~Price_reduc, data = data, 
    family = binomial(logit))
summary(model2)
exp(0.096834)

data = read.csv("disease.csv")
head(data)
model3 = glm(disease ~., data = data, family = binomial(logit))
summary(model3)

model4 = glm(disease~age+sector, data= data, family = binomial(logit))
summary(model4)
anova(model3, model4, test='Chisq')

table(data$disease)
32/98
kk = table(data$disease, model4$fitted.values > 0.3163265)
sum(kk)
reduce_M = c('èª˜ì‡¨ì»??ë£?' = 23/31, '??“…??” ?ë£?' = 47/(47+20))
kk1 = table(data$disease, model4$fitted.values > 0.3163265)
kk1
fulmode_M = c('èª˜ì‡¨ì»??ë£?' = 23/31, '??“…??” ?ë£?' = 49/(49+18))
reduce_M
fulmode_M
err_m1 = 28/sum(kk)
kk1
err_m2 = 26/sum(kk1)
err_m1
err_m2
install.packages("Deducer")
library(Deducer)
rocplot(model3)
rocplot(model4)













##########################################################
##### HW æ¿¡ì’–??€??’ª??–›
## ?ë¿???’¿?‡¾ëª„ì £ ???€??” 

data = read.csv("flushot.csv")
head(data)
log_model = glm(flushot~., data= data, family = binomial(logit))
summary(log_model)
exp(0.07179)
exp(-0.09899)
exp(0.43397)
log_model2 = glm(flushot ~ age+aware,data= data, family = binomial())
summary(log_model2)
table(data$flushot)
24/(134+24)      ## --> 0.1518987
tt = table(data$flushot, log_model2$fitted.values>0.1518987)  ## 0.1518987 : ??—«?€¨ê¾§ì»?
c('èª˜ì‡¨ì»??ë£?' = 19/(5+19), '??“…??” ?ë£?' = 95/(95+40), '?ë¿???œ­??‘‰' = 45/sum(tt))  ## ?ë¿???œ­??‘‰45??’— 40+5?ë¹??ê½? ?êµ???‚©å¯??
rocplot(log_model2)

tab_01 = table(data$flushot, log_model2$fitted.values>0.1)
tab_015 = table(data$flushot, log_model2$fitted.values>0.15)
tab_02 = table(data$flushot, log_model2$fitted.values>0.2)

tab_01
tab_015
tab_02
res01 = c('èª˜ì‡¨ì»??ë£?' = tab_01[2,2]/sum(tab_01[2,1]), 
                                  '??“…??” ?ë£?' = tab_01[1,1]/sum(tab_01[1,]),
                                  '?ë¿???œ­??‘‰' = (tab_01[1,2]+tab_01[2,1]/sum(tab_01)))
res01

res015 = c('èª˜ì‡¨ì»??ë£?' = tab_015[2,2]/sum(tab_015[2,1]), 
          '??“…??” ?ë£?' = tab_015[1,1]/sum(tab_015[1,]),
          '?ë¿???œ­??‘‰' = (tab_015[1,2]+tab_015[2,1]/sum(tab_015)))
res015

res02 = c('èª˜ì‡¨ì»??ë£?' = tab_02[2,2]/sum(tab_02[2,1]), 
           '??“…??” ?ë£?' = tab_02[1,1]/sum(tab_02[1,]),
           '?ë¿???œ­??‘‰' = (tab_02[1,2]+tab_02[2,1]/sum(tab_02)))
res02

model4$fitted.values

jang = function() {
  k = seq(0.01, 0.5, 0.01)
  
  n = length(k)
  
  err_min = vector(length = n)
  sens = vector(length = n)
  spec = vector(length = n)
  
  for(i in 1:n) {
    tab = table(data$flushot, log_model2$fitted.values > k[i])
    res =  c('èª˜ì‡¨ì»??ë£?' = tab[2,2]/sum(tab[2,1]), 
             '??“…??” ?ë£?' = tab[1,1]/sum(tab[1,]),
             '?ë¿???œ­??‘‰' = (tab[1,2]+tab_02[2,1]/sum(tab)))
    err_min[i]=tab[2,1]/sum(tab[2,])
    spec[i] = tab[1,1]/sum(tab[1,])
    print(res)
  }

  print(err_min)
  print(paste("ï§¤ì’–?ƒ¼??“½ error rate = ",min(err_min),"??” ??–"))
  index=which(err_min<=min(err_min))
  print(err_min <= min(err_min))
  print(index)
  print(paste("?ë¹???–¦?ë¦???’— èª˜ì‡¨ì»??ë£? = ",sens[min(index)],"??” ??–."))
  print(paste("?ë¹???–¦?ë¦???’— ??“…??” ?ë£? = ",spec[min(index)],"??” ??–."))
  print(paste("?ë¹???–¦?ë¦???’— ?ë¿???œ­??‘‰ = ",err_min[min(index)],"??” ??–."))
  print(paste("?ë¹???–¦?ë¦???’— cutoff = ",k[min(index)],"??” ??–."))

  plot(1-spec, sens, col =2)
}


jang()









##########################################################################
############### Lecture12_??–è¹‚Â€??›¾??˜„?Œ·?š°ê¹??ê¹?_äºŒì‡±ê½??ºê¾¨í…‡?ê½?   

crime = read.csv("http://datasets.flowingdata.com/crimeRatesByState-formatted.csv")
head(crime)

rownames(crime)

rownames(crime) = crime[, 1]
rownames(crime)

## draw.segments = TRUE : ?ê¹‹ï§¢ê¾©ìŠ¦æ¹??
stars(crime[, 2:8], flip.labels = FALSE, draw.segments = TRUE, key.loc = 2)


## ï§£ë?€?…¤??‚?ë´???Ÿ¹??” ??’ª
install.packages("aplpack")
library(aplpack)
faces(crime[, 2:8])


education = read.csv("http://datasets.flowingdata.com/education.csv")
head(education)
  
library(lattice)
parallel(education[, 2:7])
parallel(education[, 2:7], horizontal.axis = FALSE)
parallel(education[, 2:7], horizontal.axis = FALSE, col = 1)
summary(education$reading)
color = education$reading>523
color
color+1
parallel(education[, 2:7], horizontal.axis = FALSE, col = color + 1)
summary(education$dropout_rate)

color = education$dropout_rate > 5.3
color
color+1
parallel(education[, 2:7], horizontal.axis = FALSE, col = color + 1)

data = read.csv("20140528_baseball.csv")
data

model = prcomp(data[, 2:6], scale = T)
model

summary(model)
plot(model)
head(data)
rownames(data) = data[,1]
head(data)

model = prcomp(data[, 2:6], scale = T)
biplot(model)
  


##########################################
###### ??–è¹‚Â€??›¾ ?ë¿???’¿?‡¾ëª„ì £  - HW ??–è¹‚Â€??›¾?ºê¾©ê½

####1è¸?? 20140528_baseball.csv??’— 2014??€? 5??¡ 28??”ª ??½??˜± ?ë¸³æ´? ?ë´½æ¿¡?’–ë¹æ´? åª?? ???€??“½ ?ê½???Ÿ»??“£ è¹‚ëŒë¿¬ä»¥?€??–.??”  ??˜„?Œ·?š®?? ??” ??Šœ?ë¹? è¹‚ê¾§? ‡?”±?,ï§£ë?€?…¤??‚?ë´???Ÿ¹??” ??’ª, ?êµ???” ??˜¿å¯ƒëš¯?”ª ï§¡â‘¦?“ƒ?‘œ? ??Ÿ»?? …?ë¸? label??“£ ?ë£??ë¸??ë¸??ë¿? æ´¹ëªƒ?”?€?? ?®ê¾©ë“‚?ë¸? ??™£?ê½???“£ åª›Â€ï§Â€??’— æ´¹ëªƒï¼???‘æ¿?? ?êµ???Š»?ë¼? åª?? æ´¹ëªƒï¼???”  ?ë¼??ë¼? è¹‚Â€??‹”??Ÿ» ??“…ï§ëº¤?“£ åª›Â€ï§Â€??’—ï§Â€ ?ê½???‹ ?ë¸??ë¿???”ª.
data = read.csv("20140528_baseball.csv")
head(data)
rownames(data) = data[,1]
head(data)
stars(data[, 2:6], flip.labels = F, key.loc = c(9,3), draw.segments = T)
faces(data[, 2:6])


#### 2è¸??	2013_baseball.csv??’— 2013??€? ??–†ï§?? åª?? ???€??˜„??“½ ?ê½???Ÿ»??“£ ?ë£??ë¸??ë¸??€?? ??—³??–.?ë£??ë»¾é†«?š°ëª? ?ëµ†æ¿¡???“£ ??†¢??Šœ?ë¹? ?ê½???‹”?ë±???“½ ?ê½???Ÿ» ??™£?ê½??ë¿? ?ë¼??ë¼? å¯ƒì?€ë¼???”  ??—³??’—ï§Â€ ?ë¸??ë¸˜è¹‚??€? ® ?ë¸???–.?ë£·ï§?€??€? è¹??,???€è¹?? ?ë£??ë»¾é†«?š°ëª? ?ëµ†æ¿¡???“£ æ´¹ëªƒ?”?€?? åª?? ?ë£·ï§?€??€?,??ƒŠ???€ ???€è¹?? ???€??˜„??“½ ?ê½???Ÿ»?ë¿? ?ë¼??ë¼? å¯ƒì?€ë¼???”  ??—³??’—ï§Â€ ?ê½???‹ ?ë¸???”ª.
bb2013 = read.csv("2013_baseball.csv")
head(bb2013)
position = bb2013$?ë£·ï§?€??€?
head(position)
base2_pos = bb2013[,c(2, 4:11)]
base2_pos2 = aggregate(base2_pos[, 2:9], by = list(?ë£·ï§?€??€? = base2_pos$?ë£·ï§?€??€?), sum)
head(base2_pos2)
rownames(base2_pos2) = base2_pos2[,1]
head(base2_pos2)
library(lattice)
parallel(base2_pos2[,2:9], horizontal.axis = F, col =1)


# ???€è¹‚ê¾ªë£??ë»¾é†«?š°ëª?
team = bb2013$???€
parallel(~bb2013[,4:11]|team,horizontal.axis = F, col =1)


######## 3è¸??	2013_baseball.csv?ë¿? ??—³??’— åª?? ???€??˜„?ë¿? ???€?ë¸? è¹‚Â€??‹”?‘œ? ?ê¶???Šœ?ë¸??ë¿? äºŒì‡±ê½??º? ?ºê¾©ê½??“£ ??–†?ë»??ë¸???”ª.??Ÿ»??–¦?ë¸? äºŒì‡±ê½??ºê¾©ì“½ åª›ì’–?‹”?‘œ? ??™†?ë¸??ë¸??€?? ?ë¹???–¦ äºŒì‡±ê½??ºê¾¨ë±¾æ¿?? ?ê½•ï§?‚…ë¦???’— ?ºê¾©ê¶›??“½ ?®ê¾©ì‘‰??“£ ?´?‹ë¸¯??”ª.?ë»??? ¹?ë£„ç‘œ? ??„»?ë¹? ?ê½???‹”?ë±???“½ ??“…ï§ëº¤?”  ?ë¼??ë¼¸å¯ƒ? ??™†?ë¸??ë¦???’—ï§Â€ ?ê¶??? £è¹‚ëŒ?–†??‚¤.
rownames(bb2013) = bb2013[,1]
rownames(bb2013)
model = prcomp(bb2013[,4:11], scale = T)
plot(model)
summary(model)
biplot(model)





